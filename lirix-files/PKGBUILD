pkgname=lirix-files
pkgver=1
pkgrel=1
pkgdesc='Branding files for Lirix + Filesystem generator'
arch=('x86_64')
license=('BSD3')
depends=('iana-etc')
backup=('etc/crypttab' 'etc/fstab' 'etc/gettytab' 'etc/group' 'etc/gshadow' 'etc/host.conf'
        'etc/hosts' 'etc/issue' 'etc/ld.so.conf' 'etc/motd' 'etc/nsswitch.conf'
        'etc/passwd' 'etc/profile' 'etc/resolv.conf' 'etc/securetty'
        'etc/shadow' 'etc/shells')
source=('crypttab' 'env-generator' 'fstab' 'gettytab' 'group' 'gshadow' 'host.conf' 'hosts'
        'issue' 'ld.so.conf' 'lirixgttab.service' 'locale.sh' 'motd' 'nsswitch.conf' 'os-release'
        'passwd' 'profile' 'resolv.conf' 'securetty' 'shadow' 'shells' 'sysctl'
        'sysusers' 'tmpfiles' 'lirix-banner-icon.png' 'lirix-banner.png' 'lirix-icon-bg.png' 'lirix-icon-nohex.png' 'lirix-icon.png' 'lirix-wordmark-bg.png' 'lirix-wordmark.png')
conflicts=('filesystem')
provides=('filesystem=2020.09.03')
sha512sums=('d73fd912071588f46a92dd55e0e1e6fabd078876f6089aa6b05b79e52c03e58aa90a8bc18e5346e588b18295187cdb40dc69916b0e478a901d09b9ba4fd94ff5'
            '46e17cf2b19377c9849d42012cf2ba920801c5b3d54fc09b2805c0e07acb14b4f6814b4fa7d476ea8543cafc6e7de115bd371fc807fc23517174365c84ab3762'
            'e0b1230e16444c6483c067691453bcd8ca9cbbedd45b3834350b41e477bdf91db7663da55092975c573c763e17107b1ae7c69c4bb9309096e204b81d97f4febf'
            'c9283a745c1553020b9383eb54b91ff1f7048ac5e75a6da76a4a45f99e153a7c0996938404ec338bb9be939dafb282d2d92a103950e6f25b289073f12ddee2ef'
            '8889ac9a4e129647bd9b79059243e2e310f13bb8f4ffa2fdb5eefc877b9aeef325e695d3c6d943b7ab04f5951ba481b0eb7a65e20840a5c7361d25f9cd91b5ed'
            '2bc2e0373db2d589d806c16918fb97a7212c65d1bde6c9ef90372194979b7a4539aee530c5077adba66ccab284332bad0340333480f103495768517deaf52259'
            '80d46df5700438df884704901b7b1d4cebd4bb65c82871a48c03f3a47976efc88b52ea4983b6a09538bbb62ae3cadf08c38e4dd49e2fa700d6f627f4c4820770'
            'b6ee380fb17f6bc714a7174a942a76804790b8bed4277b39b277b6324c74365b4b15d298339c2292efa026b50981f3896aa6bcf9b25f143899f16e370d5039c4'
            '34e7d30b107275cbd30140ebbd619d26e343347792d1d0fc684ce7a91d7fc1f3f670fc1625070ad669b77c2160738a75a2cb3f78ac7b21bfb7dec03fde0f606c'
            '489a440750cab754d3d0769e28e75723868a6d246647b9800f5113edb0178c535b7c415d8ce8697cc60c28c1ee91dcd37a17482017c42ce9139818f66bf84a77'
            '871eb34d169df493d16abfaf5a5bb8c544deb1d9fe8070bcdefc092ef2477ae6853edd85d57fddba4bfd96139988c0245d9946fee48bfac42af4be82c69b4d27'
            '24899489c38ab711f239f62be98ffde9afc4b620773a01896ed5455d01f60b7ad6a1366892cbb23d6695cd45eceb54b59e8cfa29acbf9c2c9356bba5c495193b'
            'cf83e1357eefb8bdf1542850d66d8007d620e4050b5715dc83f4a921d36ce9ce47d0d13c5d85f2b0ff8318d2877eec2f63b931bd47417a81a538327af927da3e'
            'f2bdc4ad3b555a0dbc4629c1ad9fc4e436c1f6dd31e608f53d0367e61f38d8fb00d7c855ee821c6adfc79ee49d28e340f51d6e97c91c6d869af8721d8f3e246e'
            '59b69853bd6fa0740848ff0b089e42331e3307513616a8c564b3903ab6579ae37382447218bccb082578a0e717c8947b703937daaa40e8ae7a2e87d2654ca96e'
            '4aa6b9f776575c2fd6072399ef7545f13132ab22f6c9718961c38773632517687d6373f05c7bdd83bf0c33942d5c58cab1941ab68e359c218ef5d45f9451d3ef'
            '9754095549f77a671c1dea388c0a410cbf089eba1d2fcc6c0c5c1ffe98d6f46f61a1b759da947e7d8994503ff25c78a779d755f6fd5b59020806a8c1b56ae9aa'
            '10a3bdb68110914d6d55a401166a0e4a6b4c3e66e8c90f628289229d0f84400ddbab477631fb7b7470b14ec5313e4ef38efc0eb2bf2b6f530c3d48ad4ec0afcc'
            '7796815901a806569c23e9a8fbf1e08fd397814b8327a50f7857f6c83c9a7bb033aefb7ea58f80562ee970258186f06cdbf0b06b8b99b7c1b883f725dea532ae'
            '843965e81f8ab67a27c182d5f9eb5c19f4b8a3f815425db68ea73cd31f9e08e2b4e9bc40669a2b9c3b5fd445331ec8264e9f871d6b1a09a0c96829c74184f10b'
            '78a7485b3f24f1bec8ba74979cc0c32793419356af82013f6ed6865ee3b5cb04891db82b63c3a0436ba1e4941f93bd84a067ed7cce025fc02da937c47cca8dfa'
            'b74af5d5c6b2b504ca963666d5bdc0a47ac759992d692c3e0203fabaa4552c68d0cca3a5703b0f38062bf95b00dab0ec969e88c99126bb71482cf2d6f2b86a8f'
            '6c75e8ba2a025e3637b63cd8e352ccbd4585a80573915affc723ba292952fde1adab4eecb8ad0fb37e96da29a86af20c9c2c2a4aa20ba454b5e0d612508e2582'
            'fa6cc065bd3b51a754583b36369ac4400355af61bb99b05dc61bd04344991b262bef645789569fbdf240113ec68103e144455c6cdf235a36c4f980e369ab1ec0'
            'f58359188e1ec68bcaa4184d90210aa279dc7ed89155e85b7ef27a07bfd20538c8a90971cb4c122a9d33757c48ec4ce084d4e0cee3512b3c3f6083fc009808e4'
            '37b567d4b73d69ad1875b3a6d740ff3d740c9c1b21cb5d1d644b6120f9ce2ad940e1f7bd277d3941d57f365118e9ad79c8eea6104ae467d70e5a8cfe41eab92d'
            'da0bd221f93c8410054fa72f743fcdb19267e6bad92597751d63d7c82e1a470447820fbf5c658da8dea0d1547fd599dd9d8406835e169d16b8a7fdc697386432'
            'c6c66baf16d0e16de835e6f907d11d8842931cddfd6c0959b1f9220ac4e52f73fe7c86c2e628d0895cc722df0b87393a3650173742b2a33f75ff131d6064a22a'
            'f2636ef0f5f4364f38700910ddb8589442f08da6d5f8a305eee0ca442ece6d36287f0fca0ea2c13de40fe6c2d96dd74f8967fcfd4e818e27fee85e180c9a6f67'
            '1b7dc412e4a38f502021888ff2b4d0327cd1d7ce6f834fd765572ab4389ce71184f6b08e24cd4e61fa467296ec5bd4c9e01a85bd998d08035fc3960b2af95841'
            'f8ab734cf5816c80cd3af0a7ec982b98d139cc205bf2f40b310c3ca32d5f418990f01c846b755b2a1ddf34ba3a5e56ddb9388a428eeeaffd6a8f034f960aa110')

package() {
	cd "$pkgdir"
	# Setup root filesystem
	for d in boot dev etc mnt usr usr/people var opt srv/http run; do
		install -d -m755 $d
	done
	install -d -m555 proc
	install -d -m555 sys
	install -d -m0750 root
	install -d -m1777 tmp
	install -d -m555 -g 11 srv/ftp

	# Setup /etc and /usr/share/factory/etc
	install -d etc/{ld.so.conf.d,skel,profile.d} usr/share/factory/etc
	for f in fstab group host.conf hosts gettytab issue ld.so.conf motd nsswitch.conf \
		passwd resolv.conf securetty shells profile; do
		install -m644 "$srcdir"/$f etc/
		install -m644 "$srcdir"/$f usr/share/factory/etc/
	done
	ln -s ../proc/self/mounts etc/mtab
	for f in gshadow shadow crypttab; do
		install -m600 "$srcdir"/$f etc/
		install -m600 "$srcdir"/$f usr/share/factory/etc/
	done
	touch etc/lirix-release
	echo "Lirix GAMMA // rolling" > etc/lirix-release
	# Trick /opt/MaXX/bin/tellversion
	ln -s /etc/lirix-release etc/redhat-release
	
	install -m644 "$srcdir"/locale.sh etc/profile.d/locale.sh
	install -Dm644 "$srcdir"/os-release usr/lib/os-release

	# Setup /var
	for d in cache local opt log/old lib/misc empty; do
		install -d -m755 var/$d
	done
	install -d -m1777 var/{tmp,spool/mail}

	# Allow setgid games (gid 50) to write scores
	install -d -m775 -g 50 var/games
	ln -s spool/mail var/mail
	ln -s ../run var/run
	ln -s ../run/lock var/lock

	# Setup /usr hierarchy
	for d in bin include lib share/{misc,pixmaps} src; do
		install -d -m755 usr/$d
	done
	for d in {1..8}; do
		install -d -m755 usr/share/man/man$d
	done

	# Add lib symlinks
	ln -s usr/lib lib
	[[ $CARCH = 'x86_64' ]] && {
		ln -s usr/lib lib64
		ln -s lib usr/lib64
		}

	# Add bin symlinks
	ln -s usr/bin bin
	ln -s usr/bin sbin
	ln -s bin usr/sbin

	# Add /usr/people symlink
	ln -s usr/people home

	# Setup /usr/local hierarchy
	for d in bin etc games include lib man sbin share src; do
		install -d -m755 usr/local/$d
	done
	ln -s ../man usr/local/share/man

	# Setup gettytab
	for i in {1..6}; do
		install -D -m644 "$srcdir"/lirixgttab.service etc/systemd/system/lirixgttab.tty"${i}".service
		sed -i "s/ttyX/tty${i}/" etc/systemd/system/lirixgttab.tty"${i}".service
	done
	chmod +x etc/gettytab

	# Setup systemd-sysctl
	install -D -m644 "$srcdir"/sysctl usr/lib/sysctl.d/10-arch.conf

	# Setup systemd-sysusers
	install -D -m644 "$srcdir"/sysusers usr/lib/sysusers.d/arch.conf

	# Setup systemd-tmpfiles
	install -D -m644 "$srcdir"/tmpfiles usr/lib/tmpfiles.d/arch.conf

	# Setup systemd.environment-generator
	install -D -m755 "$srcdir"/env-generator usr/lib/systemd/system-environment-generators/10-arch
	
	install -Dm644 "$srcdir"/lirix-banner-icon.png usr/share/pixmaps/lirix-logo.png
	install -m644 "$srcdir"/lirix-banner.png usr/share/pixmaps/lirix-logo-ni.png
	install -m644 "$srcdir"/lirix-icon-bg.png usr/share/pixmaps/lirix-bg.png
	install -m644 "$srcdir"/lirix-icon-nohex.png usr/share/pixmaps/lirix-nh.png
	install -m644 "$srcdir"/lirix-icon.png usr/share/pixmaps/lirix.png
	install -m644 "$srcdir"/lirix-wordmark-bg.png usr/share/pixmaps/lirix-wordmark-bg.png
	install -m644 "$srcdir"/lirix-wordmark.png usr/share/pixmaps/lirix-wordmark.png
}
